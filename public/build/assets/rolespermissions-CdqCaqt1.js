import{r as s,a,j as t,L as N}from"./app-BDybw2Zf.js";import{A as k}from"./app-layout-DmxS3R7f.js";import{B as h}from"./button-CSB6wpAd.js";import{D as L}from"./DataGrid-DRi_7ODi.js";import"./index-CfJNm8vq.js";import"./index-DMMnmZHR.js";import"./shin-line-logo-DeoKgELm.js";import"./useTranslation-BA_zAzng.js";import"./TableCell-CyCKjvho.js";import"./index-va5ubIq_.js";const D=[{title:"Управление ролями",href:"/roles_permissions"}];function z(){const[m,p]=s.useState([]),[u,x]=s.useState([]),[n,g]=s.useState(""),[i,v]=s.useState(""),[l,w]=s.useState(""),[f,r]=s.useState(null);s.useEffect(()=>{a.get("/roles").then(e=>{const d=e.data.users.map(o=>({...o,rolesString:o.roles.map(c=>c.name).join(", ")||"Роли отсутствуют"}));p(e.data.roles),x(d)}).catch(e=>{console.error("Ошибка загрузки данных:",e),r("Не удалось загрузить данные с сервера.")})},[]);const S=()=>{if(!n.trim()){r("Название роли не может быть пустым.");return}a.post("/roles",{name:n}).then(e=>{alert(e.data.message),p([...m,e.data.role]),g("")}).catch(e=>{console.error("Ошибка при создании роли:",e),r("Не удалось создать роль.")})},R=()=>{if(!i||!l){r("Выберите пользователя и роль.");return}a.post("/roles/assign",{user_id:i,role_id:l}).then(e=>{alert(e.data.message),j()}).catch(e=>{console.error("Ошибка при назначении роли:",e),r("Не удалось назначить роль.")})},y=()=>{if(!i||!l){r("Выберите пользователя и роль для отмены.");return}a.post("/roles/revoke",{user_id:i,role_id:l}).then(e=>{alert(e.data.message),j()}).catch(e=>{console.error("Ошибка при отмене роли:",e),r("Не удалось отменить роль.")})},j=()=>{a.get("/roles").then(e=>{const d=e.data.users.map(o=>({...o,rolesString:o.roles.map(c=>c.name).join(", ")||"Роли отсутствуют"}));x(d)}).catch(e=>{console.error("Ошибка обновления данных пользователей:",e)})},C=[{field:"id",headerName:"ID",width:100},{field:"login",headerName:"Login",width:255},{field:"name",headerName:"Имя",width:200},{field:"email",headerName:"Email",width:250},{field:"phone",headerName:"Phone",width:200},{field:"rolesString",headerName:"Роли",width:300,cellClassName:"roles-column"}];return t.jsxs(k,{breadcrumbs:D,children:[t.jsx(N,{title:"Админ панель"}),t.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:t.jsxs("div",{style:{padding:"20px"},children:[t.jsx("h2",{children:"Управление ролями"}),f&&t.jsx("p",{style:{color:"red"},children:f}),t.jsxs("div",{children:[t.jsx("h3",{children:"Создать новую роль"}),t.jsx("input",{type:"text",value:n,onChange:e=>{g(e.target.value),r(null)},placeholder:"Название роли",style:{marginRight:"10px"}}),t.jsx(h,{onClick:S,children:"Создать"})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("h3",{children:"Назначить или отменить роль пользователю"}),t.jsxs("select",{onChange:e=>{v(e.target.value),r(null)},children:[t.jsx("option",{value:"",children:"Выберите пользователя"}),u.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{onChange:e=>{w(e.target.value),r(null)},style:{marginLeft:"10px"},children:[t.jsx("option",{value:"",children:"Выберите роль"}),m.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(h,{onClick:R,style:{marginLeft:"10px"},children:"Назначить"}),t.jsx(h,{onClick:y,style:{marginLeft:"10px",backgroundColor:"red"},children:"Отменить"})]}),t.jsxs("div",{style:{marginTop:"30px"},children:[t.jsx("h3",{children:"Список пользователей"}),t.jsx("div",{style:{width:"100%",overflowX:"auto"},children:t.jsx(L,{rows:u,columns:C,pageSizeOptions:[25,50,100],initialState:{pagination:{paginationModel:{pageSize:25,page:0}}},pagination:!0,sx:{"& .MuiDataGrid-root":{minWidth:"800px",overflowX:"auto"},"& .MuiDataGrid-columnHeaders":{width:"auto"},"& .roles-column":{whiteSpace:"normal",wordBreak:"break-word",lineHeight:"1.5",padding:"8px"},"& .MuiDataGrid-row":{height:"auto",maxHeight:"none"}}})})]})]})})]})}export{z as default};
