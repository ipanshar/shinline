import{r,a as j,j as e,R as w,L as I}from"./app-C2sKqGuk.js";import{A as M}from"./app-layout-B9z0nEEC.js";import{S as N}from"./warehouse-layout-Da9tyc2q.js";import{D as L}from"./Delete-jhUIdI9V.js";import{B as f,u as W}from"./index-DtBTvuy0.js";import{F as A,I as D,S as R,M as Y,T as G,B as K,C as P,D as B,G as g}from"./DataGrid-Bu30X-AQ.js";import{G as b,S as F,C as T,E as _}from"./GridActionsCellItem-D9LsiM9D.js";import"./button-CiXunvm5.js";import"./index-DY5GBYP5.js";import"./index-Cy5X9-6g.js";import"./shin-line-logo-DeoKgELm.js";import"./useTranslation-sWXn4umK.js";import"./heading-CQrY44G1.js";import"./index-DbH_zRjn.js";import"./common-IVtOcpAX.js";const V=({onChange:o})=>{const[c,m]=r.useState([]),[d,C]=r.useState(""),[h,u]=r.useState(""),[n,p]=r.useState(!0),[x,l]=r.useState("");r.useEffect(()=>{j.post("/yard/getyards").then(a=>{a.data.status?m(a.data.data):l(a.data.message)}).catch(()=>l("Ошибка загрузки дворов")).finally(()=>p(!1))},[]);const S=()=>{if(!d||!h.trim()){l("Заполните все поля!");return}j.post("/entrance-permit/addcheckpoint",{name:h,yard_id:d}).then(a=>{a.data.status?(u(""),o(d)):l(a.data.message)}).catch(()=>l("Ошибка добавления КПП"))};return e.jsxs(f,{sx:{maxWidth:400,margin:"auto",padding:3},children:[e.jsx("h2",{children:"Загрузить КПП"}),x&&e.jsx("p",{style:{color:"red"},children:x}),e.jsxs(A,{fullWidth:!0,sx:{mb:3},children:[e.jsx(D,{children:"Выберите двор"}),e.jsx(R,{value:d,onChange:a=>{C(a.target.value),o(a.target.value)},disabled:n,children:c.map(a=>e.jsx(Y,{value:a.id,children:a.name},a.id))})]}),e.jsx(G,{label:"Название КПП",fullWidth:!0,value:h,onChange:a=>u(a.target.value),sx:{mb:2}}),e.jsx(K,{variant:"contained",color:"secondary",fullWidth:!0,onClick:S,children:"Добавить КПП"})]})},z=()=>{const[o,c]=r.useState([]),[m,d]=r.useState(""),[C,h]=r.useState(!0),u=W("(max-width: 768px)"),[n,p]=w.useState({}),x=t=>{h(!0),j.post("/entrance-permit/getcheckpoint",{yard_id:t}).then(s=>{s.data.status&&c(s.data.data)}).catch(s=>console.error("Ошибка загрузки кпп:",s)).finally(()=>h(!1))};r.useEffect(()=>{x(m)},[]);const l=t=>{d(t),x(t)},S=t=>()=>{p({...n,[t]:{mode:g.Edit}})},a=t=>()=>{p({...n,[t]:{mode:g.View}})},y=t=>()=>{p({...n,[t]:{mode:g.View}})},k=t=>{const s={id:t.id,name:t.name};return c(o.map(i=>i.id===t.id?s:i)),j.post("/entrance-permit/updatecheckpoint",{yard_id:m,id:s.id,name:s.name,code:s.code}).then(i=>{i.data.status||console.error("Ошибка сохранения:",i.data.message)}).catch(i=>console.error("Ошибка сохранения:",i)),s},E=t=>()=>{j.post("/entrance-permit/deletecheckpoint",{id:t}).then(s=>{s.data.status?c(o.filter(i=>i.id!==t)):console.error("Ошибка удаления:",s.data.message)}).catch(s=>console.error("Ошибка удаления:",s))},v=[{field:"id",headerName:"Код",width:u?50:80},{field:"name",headerName:"Название",flex:1,minWidth:120,editable:!0},{field:"actions",headerName:"",width:120,headerAlign:"center",type:"actions",cellClassName:"actions",getActions:({id:t})=>{var i;return((i=n[t])==null?void 0:i.mode)===g.Edit?[e.jsx(b,{icon:e.jsx(F,{}),label:"Save",onClick:y(t)}),e.jsx(b,{icon:e.jsx(L,{}),label:"Delete",onClick:E(t),color:"inherit"}),e.jsx(b,{icon:e.jsx(T,{}),label:"Cancel",className:"textPrimary",onClick:a(t),color:"inherit"})]:[e.jsx(b,{icon:e.jsx(_,{}),label:"Edit",className:"textPrimary",onClick:S(t),color:"inherit"})]}}];return e.jsxs(f,{children:[e.jsx(V,{onChange:l}),e.jsxs(f,{sx:{width:"100%",maxWidth:"1200px",margin:"auto",padding:"10px"},children:[e.jsx("h2",{style:{textAlign:"center"},children:"КПП"}),C?e.jsx(f,{sx:{display:"flex",justifyContent:"center",padding:5},children:e.jsx(P,{})}):e.jsx(f,{sx:{height:500,width:"100%"},children:e.jsx(B,{rows:o,columns:v,editMode:"row",rowModesModel:n,processRowUpdate:k,getRowId:t=>t.id,pageSizeOptions:u?[5]:[5,10,20]})})]})]})},O=[{title:"КПП",href:"/warehouses/kpp"}];function de(){const[o,c]=r.useState([]),[m,d]=r.useState(!0);return r.useEffect(()=>{},[]),e.jsxs(M,{breadcrumbs:O,children:[e.jsx(I,{title:"КПП"}),e.jsx(N,{children:e.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:e.jsx("div",{className:"border-sidebar-border/70 dark:border-sidebar-border relative min-h-[100vh] flex-1 overflow-hidden rounded-xl border md:min-h-min p-4",children:e.jsx(z,{kpp:o,loading:m})})})})]})}export{de as default};
