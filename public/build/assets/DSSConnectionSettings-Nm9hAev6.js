import{r as o,j as t,a as m}from"./app-C2sKqGuk.js";import{c as k}from"./common-IVtOcpAX.js";const M=()=>{const[s,g]=o.useState(null),[d,f]=o.useState({base_url:"",user_name:"",password:"",subhour:0}),[i,x]=o.useState(!1),[S,w]=o.useState(!0),[j,y]=o.useState(!1),[b,c]=o.useState("");o.useEffect(()=>{(async()=>{try{const r=(await m.post("/dss/settings")).data;g(r),f({base_url:r.base_url,user_name:r.user_name,password:r.password,subhour:r.subhour||0})}catch(l){console.error("Ошибка загрузки настроек:",l),c("Не удалось загрузить настройки.")}finally{w(!1)}})()},[]);const u=n=>{const{name:l,value:r}=n.target;f(a=>({...a,[l]:r}))},C=async()=>{if(s){y(!0),c("");try{await m.post("/dss/settings/update",{id:s.id,...d}),c("Настройки успешно сохранены"),x(!1),g(n=>n&&{...n,...d,updated_at:new Date().toISOString()})}catch(n){console.error("Ошибка при сохранении:",n),c("Ошибка при сохранении настроек")}finally{y(!1)}}},_=n=>{const r=new Date().getTime()-n.getTime(),a=Math.floor(r/1e3),h=Math.floor(a/60),p=Math.floor(h/60),v=Math.floor(p/24);return a<60?`${a} сек. назад`:h<60?`${h} мин. назад`:p<24?`${p} ч. назад`:`${v} дн. назад`};return S?t.jsx("div",{style:e.container,children:"Загрузка настроек..."}):s?t.jsxs("div",{style:e.container,children:[t.jsx("strong",{children:"Настройки подключения к серверу DSS"}),t.jsx("table",{style:e.table,children:t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Базовый URL"})}),t.jsx("td",{style:e.td,children:i?t.jsx("input",{name:"base_url",value:d.base_url,onChange:u,style:e.input}):s.base_url})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Логин"})}),t.jsx("td",{style:e.td,children:i?t.jsx("input",{name:"user_name",value:d.user_name,onChange:u,style:e.input}):s.user_name})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Пароль"})}),t.jsx("td",{style:e.td,children:i?t.jsx("input",{name:"password",type:"password",value:d.password,onChange:u,style:e.input}):"********"})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Часы хранения"})}),t.jsx("td",{style:e.td,children:i?t.jsx("input",{name:"subhour",value:d.subhour,onChange:u,style:e.input}):s.subhour||"—"})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Тип клиента"})}),t.jsx("td",{style:e.td,children:s.client_type})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Токен"})}),t.jsx("td",{style:e.td,children:s.token||"—"})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Токен учета"})}),t.jsx("td",{style:e.td,children:s.credential||"—"})]}),t.jsxs("tr",{children:[t.jsx("td",{style:e.td,children:t.jsx("strong",{children:"Активность"})}),t.jsx("td",{style:e.td,children:s.keepalive?_(new Date(s.keepalive)):"—"})]})]})}),t.jsx("div",{style:e.buttonRow,children:i?t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:C,disabled:j,style:e.button,children:j?"Сохранение...":"Сохранить"}),t.jsx("button",{onClick:()=>x(!1),style:e.cancelButton,children:"Отмена"})]}):t.jsx("button",{onClick:()=>x(!0),style:e.button,children:"Редактировать"})}),b&&t.jsx("div",{style:e.message,children:b})]}):t.jsx("div",{style:e.container,children:"Ошибка загрузки конфигурации."})},e={container:{padding:"20px",fontFamily:"Arial, sans-serif",backgroundColor:"#f5f5f5",borderRadius:"8px",maxWidth:"600px",margin:"auto",marginTop:"40px",boxShadow:"0 0 10px rgba(0,0,0,0.1)"},table:{width:"100%",borderCollapse:"collapse",marginBottom:"20px"},td:{padding:"10px",borderBottom:"1px solid #ddd"},input:{border:"1px solid #ddd",borderRadius:"4px",backgroundColor:k.white,width:"100%",padding:"6px",fontSize:"14px"},buttonRow:{display:"flex",gap:"10px"},button:{padding:"8px 16px",backgroundColor:"#1976d2",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},cancelButton:{padding:"8px 16px",backgroundColor:"#777",color:"#fff",border:"none",borderRadius:"4px",cursor:"pointer"},message:{marginTop:"10px",color:"#007700",fontWeight:"bold"}};export{M as D};
