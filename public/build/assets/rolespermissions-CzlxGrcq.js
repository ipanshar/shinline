import{r,a,j as t,L as k}from"./app-a8shZ7xm.js";import{A as N}from"./app-layout-CF8xOiHp.js";import{B as h}from"./button-DIhWO5lu.js";import{D as L}from"./DataGrid-DKtW1Rxd.js";import"./index-DN5Hf7i_.js";import"./index-99iC4-Ys.js";import"./shin-line-logo-DeoKgELm.js";import"./index-DK6kF-IZ.js";const D=[{title:"Управление ролями",href:"/roles_permissions"}];function H(){const[m,p]=r.useState([]),[u,x]=r.useState([]),[n,g]=r.useState(""),[l,v]=r.useState(""),[i,w]=r.useState(""),[j,s]=r.useState(null);r.useEffect(()=>{a.get("/roles").then(e=>{const d=e.data.users.map(o=>({...o,rolesString:o.roles.map(c=>c.name).join(", ")||"Роли отсутствуют"}));p(e.data.roles),x(d)}).catch(e=>{console.error("Ошибка загрузки данных:",e),s("Не удалось загрузить данные с сервера.")})},[]);const S=()=>{if(!n.trim()){s("Название роли не может быть пустым.");return}a.post("/roles",{name:n}).then(e=>{alert(e.data.message),p([...m,e.data.role]),g("")}).catch(e=>{console.error("Ошибка при создании роли:",e),s("Не удалось создать роль.")})},R=()=>{if(!l||!i){s("Выберите пользователя и роль.");return}a.post("/roles/assign",{user_id:l,role_id:i}).then(e=>{alert(e.data.message),f()}).catch(e=>{console.error("Ошибка при назначении роли:",e),s("Не удалось назначить роль.")})},y=()=>{if(!l||!i){s("Выберите пользователя и роль для отмены.");return}a.post("/roles/revoke",{user_id:l,role_id:i}).then(e=>{alert(e.data.message),f()}).catch(e=>{console.error("Ошибка при отмене роли:",e),s("Не удалось отменить роль.")})},f=()=>{a.get("/roles").then(e=>{const d=e.data.users.map(o=>({...o,rolesString:o.roles.map(c=>c.name).join(", ")||"Роли отсутствуют"}));x(d)}).catch(e=>{console.error("Ошибка обновления данных пользователей:",e)})},C=[{field:"id",headerName:"ID",width:100},{field:"login",headerName:"Login",width:255},{field:"name",headerName:"Имя",width:200},{field:"email",headerName:"Email",width:250},{field:"rolesString",headerName:"Роли",width:300,cellClassName:"roles-column"}];return t.jsxs(N,{breadcrumbs:D,children:[t.jsx(k,{title:"Админ панель"}),t.jsx("div",{className:"flex h-full flex-1 flex-col gap-4 rounded-xl p-4",children:t.jsxs("div",{style:{padding:"20px"},children:[t.jsx("h2",{children:"Управление ролями"}),j&&t.jsx("p",{style:{color:"red"},children:j}),t.jsxs("div",{children:[t.jsx("h3",{children:"Создать новую роль"}),t.jsx("input",{type:"text",value:n,onChange:e=>{g(e.target.value),s(null)},placeholder:"Название роли",style:{marginRight:"10px"}}),t.jsx(h,{onClick:S,children:"Создать"})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("h3",{children:"Назначить или отменить роль пользователю"}),t.jsxs("select",{onChange:e=>{v(e.target.value),s(null)},children:[t.jsx("option",{value:"",children:"Выберите пользователя"}),u.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsxs("select",{onChange:e=>{w(e.target.value),s(null)},style:{marginLeft:"10px"},children:[t.jsx("option",{value:"",children:"Выберите роль"}),m.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]}),t.jsx(h,{onClick:R,style:{marginLeft:"10px"},children:"Назначить"}),t.jsx(h,{onClick:y,style:{marginLeft:"10px",backgroundColor:"red"},children:"Отменить"})]}),t.jsxs("div",{style:{marginTop:"30px"},children:[t.jsx("h3",{children:"Список пользователей"}),t.jsx("div",{style:{width:"100%",overflowX:"auto"},children:t.jsx(L,{rows:u,columns:C,pageSizeOptions:[25,50,100],initialState:{pagination:{paginationModel:{pageSize:25,page:0}}},pagination:!0,sx:{"& .MuiDataGrid-root":{minWidth:"800px",overflowX:"auto"},"& .MuiDataGrid-columnHeaders":{width:"auto"},"& .roles-column":{whiteSpace:"normal",wordBreak:"break-word",lineHeight:"1.5",padding:"8px"},"& .MuiDataGrid-row":{height:"auto",maxHeight:"none"}}})})]})]})})]})}export{H as default};
